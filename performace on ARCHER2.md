[[_HadGEM3 MOC]]

# performance on ARCHER2
- ongoing table of performance and resource costs of some of my ARCHER2 suites
- table format similar to the benchmarks in the [NCAS CMS](http://cms.ncas.ac.uk/wiki/Archer2)

## 03/2024 STASH tests
- we got an additional 80 kCU of resources on ARCHER2, i.e. we can continue the integrations of all four CO2 levels for ~500 years each
- I currently (22/03/2024) run with production STASH with some 6-hourly data
- this does not significantly increase runtime and output file size (< ~5%), but it would be worth to really strip down the STASH for these continuation runs to decrease output files sizes and maybe also overall runtime
- below is a comparison of some test runs:

| suite  | description                                                                                                                         | date run | decomposition*  | nodes  | wallclock (h:m) for each of three years | archive file size of one year | avg. cost / model yr | comment                                                               |     |     |
| ------ | ----------------------------------------------------------------------------------------------------------------------------------- | -------- | --------------- | ------ | --------------------------------------- | ----------------------------- | -------------------- | --------------------------------------------------------------------- | --- | --- |
| dd626  | production STASH, monthly means + selected 6-hourly and daily                                                                       | 19/03/24 | 24x16x2:16x8:6  | 6:1:1  | 4:04/4:05/4:06                          | 23 GB                         | 32.7 CU              |                                                                       |     |     |
| de791  | minimum UM STASH                                                                                                                    | 22/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:59/3:59/3:57                          | 18 GB                         | 31.7 CU              |                                                                       |     |     |
| de813  | minimum UM STASH + minimum NEMO output                                                                                              | 22/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:48/3:46/3:42                          | post-proc error               | 30.0 CU              |                                                                       |     |     |
| de813B | as de813 but with normal 1m NEMO putput                                                                                             | 23/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:59/4:01                               |                               |                      | no post-processing error anymore -> related to 1m NEMO output changes |     |     |
| de841  | minimum UM STASH + minimum NEMO output + no NEMO netcdf masking                                                                     | 23/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:46/3:42/3:40                          | post-proc error               | 29.7 CU              |                                                                       |     |     |
| de841B | as de841 but with nn_write=320 instead of 1920                                                                                      | 23/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:42/                                   | post-proc error               |                      | did not resolve post-rocessing error                                  |     |     |
| de842  | minimum UM STASH + minimum NEMO output + no NEMO netcdf masking + 3 more ATM nodes                                                  | 23/03/24 | 32x18x2:16x8:6  | 9:1:1  | 3:33/3:27/3:23                          | post-proc error               | 37.9 CU              |                                                                       |     |     |
| de843  | minimum UM STASH + 1d NEMO output + no NEMO netcdf masking + 3 more ATM nodes + more OCN cores                                      | 23/03/24 | 32x18x2:16x16:6 | 9:2:1  | 2:55/2:57/2:55                          | post-proc error               | 35.2 CU              |                                                                       |     |     |
| de847  | minimum UM STASH + 1d NEMO output + no NEMO netcdf masking + 2 more ATM nodes + more OCN cores                                      | 23/03/24 | 32x16x2:16x16:6 | 8:2:1  | 3:10/3:08/3:08                          | post-proc error               | 34.7 CU              |                                                                       |     |     |
| de848  | minimum UM STASH + 1d NEMO output + no NEMO netcdf masking + more OCN cores                                                         | 23/03/24 | 24x16x2:16x16:6 | 6:2:1  | 3:40/3:40/3:41                          | post-proc error               | 33.0 CU              |                                                                       |     |     |
| de852  | minimum UM STASH + some 1m NEMO removed                                                                                             | 23/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:47/3:47/3:49                          |                               | 30.3 CU              |                                                                       |     |     |
| de853  | minimum UM STASH + some more 1m NEMO removed                                                                                        | 24/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:47/3:48/3/47                          |                               | 30.3 CU              |                                                                       |     |     |
| de855  | minimum UM STASH + even more 1m NEMO removed                                                                                        | 24/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:42/3:40/3:46                          |                               | 29.7 CU              |                                                                       |     |     |
| de860  | minimum UM STASH + nearly all 1m NEMO removed, but monthly NEMO restarts                                                            | 25/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:46/3:47/3:43                          |                               | 30.0 CU              |                                                                       |     |     |
| de895  | minimum UM STASH + nearly all 1m NEMO removed + all NEMO restarts + post-processing on serial nodes                                 | 26/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:45/3:42/3:42                          |                               | 30.0 CU              |                                                                       |     |     |
| de907  | as de895 but with no CICE output                                                                                                    | 26/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:46/3:43/3:49                          |                               | 30.1 CU              |                                                                       |     |     |
| de923  | minimum UM STASH + nearly all 1m NEMO removed + 6-monthly NEMO restarts + post-processing on serial nodes + ozone on parallel nodes | 27/03/24 | 24x16x2:16x8:6  | 6:1:1  | 3:42/3:52/4:14                          |                               | 29.6 CU              |                                                                       |     |     |
| de925  | as de923, but with more ATM and OCN cores                                                                                           | 27/03/24 | 32x18x2:16x16:6 | 9:2:1  | 2:56/3:06/3:13                          |                               | 35 CU                |                                                                       |     |     |
| de926  | as de923, but with even more ATM and OCN cores                                                                                      | 27/03/24 | 32x24x2:16x16:6 | 12:2:1 | 2:28/2:36/                              |                               | 37 CU                |                                                                       |     |     |
| de927  | as de923, but with even more more ATM and OCN cores                                                                                 | 27/03/24 | 32x28x2:16x16:6 | 14:2:1 | 2:39/2:39/2:59                          |                               | 45 CU                |                                                                       |     |     |
| de926B | as de926, but with 3-monthly NEMO restarts                                                                                          | 27/03/24 | 32x24x2:16x16:6 | 12:2:1 | 2:43/2:35                               |                               |                      |                                                                       |     |     |
| de956  | as de926B, but monthly NEMO restarts + 15 day UM dumps                                                                              | 27/03/24 | 32x24x2:16x16:6 | 12:2:1 | 2:35/2:28/                              |                               |                      |                                                                       |     |     |
| de996  | as de926B, but with 15-day (instead of 10-day) UM dumps                                                                             | 28/03/24 | 32x24x2:16x16:6 | 12:2:1 |                                         |                               |                      |                                                                       |     |     |
## STASH and dumping benchmarks
| suite   | description                                  | date run | decomposition* | nodes | length (months) | dump freq. (days) | wallclock (h:m) / month | file size | cost / model yr | comment      |
| ------- | -------------------------------------------- | -------- | -------------- | ----- | --------------- | ----------------- | ----------------------- | --------- | --------------- | ------------ |
| u-ch949 | full CMIP6 STASH                             | 21/09/21 | 12x16x2:16x8:6 | 3:1:3 | 2               | 10                | 0:42                    | 67 GB     | 59 CU           |              |
| u-ch993 | reduced CMIP6 spin-up STASH                  | 22/09/21 | 12x16x2:16x8:6 | 3:1:1 | 2               | 10                | 0:36                    | 12 GB     | 36 CU           | NEXCS config |
| u-ch983 | no STASH                                     | 22/09/21 | 12x16x2:16x8:6 | 3:1:1 | 2               | 10                | 0:34                    | 5 GB      | 34 CU           |              |
| u-ch988 | selecetd mm                                  | 22/09/21 | 12x16x2:16x8:6 | 3:1:1 | 2               | 10                | 0:34                    | 5 GB      | 34 CU           |              |
| u-ci001 | selecetd mm + monthly dumps                  | 22/09/21 | 12x16x2:16x8:6 | 3:1:1 | 2               | 30                | 0:34                    | 5 GB      | 34 CU           |              |
| u-ci002 | selecetd mm + 3-month dumps + yearly cycling | 23/09/21 | 12x16x2:16x8:6 | 3:1:1 | 12              | 90                | ?                       | ?         | ?               |              |
|         |                                              |          |                |       |                 |                   |                         |           |                 |              |

* (atm:ocean:xios)

https://ncas-cms.github.io/um-training/_images/cost-curves.jpg